# AGENTS.md

## Project

Bun + Turbo monorepo: `client/` (React/Vite), `server/` (Hono), `shared/` (Zod schemas/types).

JIT (Just-in-Time) packages — `shared` and `server` export `.ts` source directly. No compilation step. Bun runs TS natively, Vite transpiles on the fly.

## Commands (run from root)

```bash
bun install                        # install deps
bun run dev                        # all workspaces
bun run dev:client                 # client only
bun run dev:server                 # server only
bun run build                      # vite build (client only)
bun run check-types                # tsc --noEmit across workspaces
bun run lint                       # biome lint .
bun run format                     # biome format . --write
bun run test                       # run tests
```

## Directory Structure

```
client/src/
  routes/        # TanStack Router route components
  components/ui/ # shadcn/Radix UI components
  lib/           # utilities
  main.tsx       # entry
server/src/
  index.ts       # Hono app + routes
  client.ts      # typed Hono client export
shared/src/
  api/           # Zod schemas per endpoint (no barrel files)
  types/         # shared types
```

No `dist/` for shared or server — exports point to `src/*.ts` directly.

## Path Aliases

- `@server/*` → `./server/src/*`
- `@client/*` → `./client/src/*`
- `@shared/*` → `./shared/src/*`
- `@/*` → `./src/*` (inside client only)

Cross-workspace imports use package subpaths: `import { x } from "shared/api/hello"`, `import { y } from "server/client"`.

## Code Style

**Formatter**: Biome. Tabs, double quotes. Run `bun run format` before committing.

**Linting**: Biome recommended rules. Run `bun run lint`.

**TypeScript**: Strict mode (`strict: true`, `noUncheckedIndexedAccess`, `noFallthroughCasesInSwitch`). Target ESNext. Use `verbatimModuleSyntax`.

**Imports**: Named exports preferred. ES module syntax only. Biome auto-organizes imports.

**Naming**: PascalCase for components/types. camelCase for variables/functions. Zod schemas suffixed with `Schema` (e.g. `helloRequestSchema`).

**Validation**: Zod schemas in `shared/`, used by both client and server. Server uses `zValidator()` middleware from `@hono/zod-validator`. Responses validated with Zod before sending.

**Shared package**: No barrel files. One module per endpoint under `shared/src/api/`. Exports map in `package.json` — import via `"shared/api/hello"`. Changes are available immediately (no rebuild).

**Error handling**: Server relies on Zod validation + Hono error handling. No global error boundary yet.

**Generated files**: Do NOT edit `client/src/routeTree.gen.ts` — auto-generated by TanStack Router.

## End-to-End Type Safety

Type-safe API calls flow through a chain across all three packages:

```
shared/src/api/hello.ts          → Zod schemas (source of truth)
       ↓
server/src/index.ts              → `app` uses schemas via zValidator(); routes are
                                    METHOD-CHAINED on `new Hono()` so the full route
                                    type is inferred on `app` (do NOT use separate
                                    `app.get(...)` statements — breaks type inference)
       ↓
server/src/client.ts             → `AppType = typeof app` captures all route types;
                                    exports `hcWithType` (typed Hono RPC client)
       ↓
client/src/routes/*.tsx          → `import { hcWithType } from "server/client"`
                                    gives fully typed `client.hello.$post(...)` etc.
```

**Critical**: The Hono app in `server/src/index.ts` MUST use method chaining (`new Hono().get(...).post(...)`) so TypeScript infers all route types on the single `app` variable. Using `app.get(...); app.post(...)` as separate statements loses the accumulated route type — the client would see `unknown`.

## Hono Notes

- API-only on VPS is fine; use Bun runtime with Hono.
- `hc` RPC client gives end-to-end types when `AppType = typeof app` is exported.
- Always validate inputs with `zValidator()` and outputs with `schema.parse()`.
- `hc` path params do not match `/`; encode with `encodeURIComponent`.
- Bun request body limit defaults to 128MiB; raise `Bun.serve({ maxRequestBodySize })` if needed.
